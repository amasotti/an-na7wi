name: 🚀 CI Pipeline

# This workflow builds, tests, and lints both backend and frontend in parallel
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-gradle

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Allows manual triggering

env:
  ANTHROPIC_API_KEY: 'a-dummy-anthropic-api-key'

jobs:
  backend:
    name: 🏗️ Backend Build and Test
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v5

      - name: 🔍 Run backend checks
        uses: ./.github/actions/backend-check

      - name: 📝 Backend Build Summary
        if: always()
        run: |
          echo "## 🚀 Backend Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "* 🏗️ Build Status: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "* 📦 Commit: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "* 👤 Triggered by: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "* 🔗 Workflow run: [View Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
  
  frontend:
    name: 🖌️ Frontend Lint, Test and Build
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v5

      - name: 🔍 Run frontend checks
        uses: ./.github/actions/frontend-check

      - name: 📝 Frontend Build Summary
        if: always()
        run: |
          echo "## 🚀 Frontend Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "* 🏗️ Build Status: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "* 📦 Commit: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "* 👤 Triggered by: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "* 🔗 Workflow run: [View Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
