name: ðŸš€ CI Pipeline

# This workflow builds, tests, and lints both backend and frontend in parallel
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-gradle

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Allows manual triggering

env:
  ANTHROPIC_API_KEY: 'a-dummy-anthropic-api-key'

jobs:
  backend:
    name: ðŸ—ï¸ Backend Build and Test
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v5

      - name: ðŸ” Run backend checks
        uses: ./.github/actions/backend-check

      - name: ðŸ“ Backend Build Summary
        if: always()
        run: |
          echo "## ðŸš€ Backend Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "* ðŸ—ï¸ Build Status: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "* ðŸ“¦ Commit: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "* ðŸ‘¤ Triggered by: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "* ðŸ”— Workflow run: [View Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
  
  frontend:
    name: ðŸ–Œï¸ Frontend Lint, Test and Build
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v5

      - name: ðŸ” Run frontend checks
        uses: ./.github/actions/frontend-check

      - name: ðŸ“ Frontend Build Summary
        if: always()
        run: |
          echo "## ðŸš€ Frontend Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "* ðŸ—ï¸ Build Status: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "* ðŸ“¦ Commit: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "* ðŸ‘¤ Triggered by: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "* ðŸ”— Workflow run: [View Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
